<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>OnlineBrokers</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="icon" href="pictures/pillar_icon.png">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <header>
        <div class="title">
            <h1 class="centered-content">
                <img src="pictures/pillar.png" class="titlePicture">
                <span class="pageTitle">ONLINE</span>
                <span class="pageTitle2">BROKERS</span>
            </h1>
        </div>
    </header>
    <hr class="hrTitle">
    <div class="main">
        <div class="stocks" id="stocks">
            <table class="stockTable">
                <tr class="names">
                    <td class="stockInfo">Instrument</td>
                    <td class="stockInfo">Value</td>
                    <td class="stockInfo">Gain</td>
                    <td class="stockInfo">%</td>
                </tr>
                <tr id="rowSMCI">
                    <td class="stockName">SMCI<br><span class="stockNameLong">Super Micro Computer Inc.</span></td>
                    <td class="stock" id="numberSMCI"></td>
                    <td class="stock" id="numSMCI"></td>
                    <td class="stock" id="proSMCI"></td>
                </tr>
                <tr id="rowTSLA">
                    <td class="stockName">TSLA<br><span class="stockNameLong">Tesla Motors</span></td>
                    <td class="stock" id="numberTSLA"></td>
                    <td class="stock" id="numTSLA"></td>
                    <td class="stock" id="proTSLA"></td>
                </tr>
                <tr id="rowAMZN">
                    <td class="stockName">AMZN<br><span class="stockNameLong">Amazon.com, Inc.</span></td>
                    <td class="stock" id="numberAMZN"></td>
                    <td class="stock" id="numAMZN"></td>
                    <td class="stock" id="proAMZN"></td>
                </tr>
                <tr id="rowMSFT">
                    <td class="stockName">MSFT<br><span class="stockNameLong">Microsoft Corp.</span></td>
                    <td class="stock" id="numberMSFT"></td>
                    <td class="stock" id="numMSFT"></td>
                    <td class="stock" id="proMSFT"></td>
                </tr>
                <tr id="rowBTC">
                    <td class="stockName">BTC<br><span class="stockNameLong">Bitcoin</span></td>
                    <td class="stock" id="numberBTC"></td>
                    <td class="stock" id="numBTC"></td>
                    <td class="stock" id="proBTC"></td>
                </tr>
                <tr id="rowXRP">
                    <td class="stockName">XRP<br><span class="stockNameLong">Ripple</span></td>
                    <td class="stock" id="numberXRP"></td>
                    <td class="stock" id="numXRP"></td>
                    <td class="stock" id="proXRP"></td>
                </tr>
                <tr class="bottom" id="rowHEIA">
                    <td class="stockName">HEIA<br><span class="stockNameLong">Heineken N.V.</span></td>
                    <td class="stock" id="numberHEIA"></td>
                    <td class="stock" id="numHEIA"></td>
                    <td class="stock" id="proHEIA"></td>
                </tr>
            </table>
        </div>
        <div class="portfolio" id="port">
            <div class="up">
                <div id="balTxt">BALANCE:</div><div id="balance">0</div>
            </div>
            <div class="down">
                <h2 class="portTitle">PORTFOLIO</h2>
                <table id="portTable"></table>
            </div>
        </div>
    </div>
    <!-- ------------------------------------------------------------------------- SMCI ---------------------------------------------------------------------- -->
    <div id="overlaySMCI" class="hidden">
        <div class="form">
            <h2 class="overlayTitle">BUY SMCI STOCK</h2>
            <table class="overlayTable">
                <tr>
                    <td class="usd" id="cell1S" onclick="toggleColors('cell1', 'S')">USD</td>
                    <td class="shares" id="cell2S" onclick="toggleColors('cell2', 'S')">Shares</td>
                </tr>
            </table>
            <form action="">
                <input type="number" class="numberInput" id="stockInputSMCI" placeholder="Quantity" required><br>
                <button class="overlaySubmit" id="overlaySubmitSMCI">SUBMIT</button>
                <button class="overlayCancel" id="overlayCancelSMCI">CANCEL</button>
            </form>
        </div>
    </div>

    <!-- ------------------------------------------------------------------------- TSLA ---------------------------------------------------------------------- -->
    <div id="overlayTSLA" class="hidden">
        <div class="form">
            <h2 class="overlayTitle">BUY TSLA STOCK</h2>
            <table class="overlayTable">
                <tr>
                    <td class="usd" id="cell1T" onclick="toggleColors('cell1', 'T')">USD</td>
                    <td class="shares" id="cell2T" onclick="toggleColors('cell2', 'T')">Shares</td>
                </tr>
            </table>
            <form action="">
                <input type="number" class="numberInput" id="stockInputTSLA" placeholder="Quantity" required><br>
                <button class="overlaySubmit" id="overlaySubmitTSLA">SUBMIT</button>
                <button class="overlayCancel" id="overlayCancelTSLA">CANCEL</button>
            </form>
        </div>
    </div>

    <!-- ------------------------------------------------------------------------- AMZN ---------------------------------------------------------------------- -->

    <div id="overlayAMZN" class="hidden">
        <div class="form">
            <h2 class="overlayTitle">BUY AMZN STOCK</h2>
            <table class="overlayTable">
                <tr>
                    <td class="usd" id="cell1A" onclick="toggleColors('cell1', 'A')">USD</td>
                    <td class="shares" id="cell2A" onclick="toggleColors('cell2', 'A')">Shares</td>
                </tr>
            </table>
            <form action="">
                <input type="number" class="numberInput" id="stockInputAMZN" placeholder="Quantity" required><br>
                <button class="overlaySubmit" id="overlaySubmitAMZN">SUBMIT</button>
                <button class="overlayCancel" id="overlayCancelAMZN">CANCEL</button>
            </form>
        </div>
    </div>

    <!-- ------------------------------------------------------------------------- MSFT ---------------------------------------------------------------------- -->

    <div id="overlayMSFT" class="hidden">
        <div class="form">
            <h2 class="overlayTitle">BUY MSFT STOCK</h2>
            <table class="overlayTable">
                <tr>
                    <td class="usd" id="cell1M" onclick="toggleColors('cell1', 'M')">USD</td>
                    <td class="shares" id="cell2M" onclick="toggleColors('cell2', 'M')">Shares</td>
                </tr>
            </table>
            <form action="">
                <input type="number" class="numberInput" id="stockInputMSFT" placeholder="Quantity" required><br>
                <button class="overlaySubmit" id="overlaySubmitMSFT">SUBMIT</button>
                <button class="overlayCancel" id="overlayCancelMSFT">CANCEL</button>
            </form>
        </div>
    </div>

    <!-- ------------------------------------------------------------------------- BTC ---------------------------------------------------------------------- -->

    <div id="overlayBTC" class="hidden">
        <div class="form">
            <h2 class="overlayTitle">BUY BTC STOCK</h2>
            <table class="overlayTable">
                <tr>
                    <td class="usd" id="cell1B" onclick="toggleColors('cell1', 'B')">USD</td>
                    <td class="shares" id="cell2B" onclick="toggleColors('cell2', 'B')">Shares</td>
                </tr>
            </table>
            <form action="">
                <input type="number" class="numberInput" id="stockInputBTC" placeholder="Quantity" required><br>
                <button class="overlaySubmit" id="overlaySubmitBTC">SUBMIT</button>
                <button class="overlayCancel" id="overlayCancelBTC">CANCEL</button>
            </form>
        </div>
    </div>

    <!-- ------------------------------------------------------------------------- XRP ---------------------------------------------------------------------- -->

    <div id="overlayXRP" class="hidden">
        <div class="form">
            <h2 class="overlayTitle">BUY XRP STOCK</h2>
            <table class="overlayTable">
                <tr>
                    <td class="usd" id="cell1X" onclick="toggleColors('cell1', 'X')">USD</td>
                    <td class="shares" id="cell2X" onclick="toggleColors('cell2', 'X')">Shares</td>
                </tr>
            </table>
            <form action="">
                <input type="number" class="numberInput" id="stockInputXRP" placeholder="Quantity" required><br>
                <button class="overlaySubmit" id="overlaySubmitXRP">SUBMIT</button>
                <button class="overlayCancel" id="overlayCancelXRP">CANCEL</button>
            </form>
        </div>
    </div>

    <!-- ------------------------------------------------------------------------- HEIA ---------------------------------------------------------------------- -->

    <div id="overlayHEIA" class="hidden">
        <div class="form">
            <h2 class="overlayTitle">BUY HEIA STOCK</h2>
            <table class="overlayTable">
                <tr>
                    <td class="usd" id="cell1H" onclick="toggleColors('cell1', 'H')">USD</td>
                    <td class="shares" id="cell2H" onclick="toggleColors('cell2', 'H')">Shares</td>
                </tr>
            </table>
            <form action="">
                <input type="number" class="numberInput" id="stockInputHEIA" placeholder="Quantity" required><br>
                <button class="overlaySubmit" id="overlaySubmitHEIA">SUBMIT</button>
                <button class="overlayCancel" id="overlayCancelHEIA">CANCEL</button>
            </form>
        </div>
    </div>

    <script>
        function toggleColors(clickedCell, stockId) {
            const cell1 = document.getElementById(`cell1${stockId}`);
            const cell2 = document.getElementById(`cell2${stockId}`);

            if (clickedCell === 'cell1') {
                cell1.classList.remove("black");
                cell1.classList.add("red");
                cell2.classList.remove("red");
                cell2.classList.add("black");
                val = 0;
            } else {
                cell1.classList.remove("red");
                cell1.classList.add("black");
                cell2.classList.remove("black");
                cell2.classList.add("red");
                val = 1;
            }
        }
    </script>

    <hr class="hrFooter">
    <footer>
        <h5><span id="copyright">Â© www.copyright.com</span></h5>
    </footer>
</body>
<script>
    function refreshContent() {
        $.ajax({
            type: "GET",
            url: "content.php?_=" + new Date().getTime(),
            dataType: "json",
            success: function (data) {
                $("#numberSMCI").text(data.SMCI.number);
                $("#numSMCI").html(data.SMCI.gain);
                $("#proSMCI").html(data.SMCI.percentage);

                $("#numberTSLA").text(data.TSLA.number);
                $("#numTSLA").html(data.TSLA.gain);
                $("#proTSLA").html(data.TSLA.percentage);

                $("#numberAMZN").text(data.AMZN.number);
                $("#numAMZN").html(data.AMZN.gain);
                $("#proAMZN").html(data.AMZN.percentage);

                $("#numberMSFT").text(data.MSFT.number);
                $("#numMSFT").html(data.MSFT.gain);
                $("#proMSFT").html(data.MSFT.percentage);

                $("#numberBTC").text(data.BTC.number);
                $("#numBTC").html(data.BTC.gain);
                $("#proBTC").html(data.BTC.percentage);

                $("#numberXRP").text(data.XRP.number);
                $("#numXRP").html(data.XRP.gain);
                $("#proXRP").html(data.XRP.percentage);

                $("#numberHEIA").text(data.HEIA.number);
                $("#numHEIA").html(data.HEIA.gain);
                $("#proHEIA").html(data.HEIA.percentage);

                purchasedStocks.forEach((stock) => {
                    const oldValue = parseFloat(stock[3]);
                    const newValue = parseFloat((data[stock[0]].number).replace(/,/g, ''));
                    const percentageGain = (((newValue - oldValue) / oldValue) * 100).toFixed(2);
                    const value = parseFloat(stock[1]);
                    const value2 = parseFloat(stock[6]);
                    const finalValue = value + (value * (percentageGain / 100));
                    stock[6] = finalValue.toString();
                  
                    const existingEntryIndex = sessionCells.findIndex(entry => entry['name' + stock[0]] === stock[0]);
                    if (existingEntryIndex !== -1) {
                        sessionCells[existingEntryIndex]['newValue' + stock[0]] = finalValue;
                    }
                  
                    const cell = document.getElementById("cell2" + stock[0]);
                    if (cell) {
                      cell.textContent = finalValue.toFixed(2);
                    }

                    updateStockColor(value.toFixed(2), value2.toFixed(2), cell);
                });

                const totalSum = purchasedStocks.reduce((sum, stock) => sum + parseFloat(stock[6]), 0);
                const totalSumDiv = document.getElementById('balance');
                totalSumDiv.textContent = totalSum.toFixed(2);
                sessionStorage.setItem('sumValue', (totalSum.toFixed(2)));

                localStorage.setItem('stockData', JSON.stringify(data));
            },
            error: function (xhr, status, error) {
                console.error("Error:", xhr);
            }
        });
    }

    //Check if there is data in Local Storage and use it if available
    var storedData = localStorage.getItem('stockData');
    if (storedData) {
        var data = JSON.parse(storedData);
        $("#numberSMCI").text(data.SMCI.number);
        $("#numSMCI").html(data.SMCI.gain);
        $("#proSMCI").html(data.SMCI.percentage);

        $("#numberTSLA").text(data.TSLA.number);
        $("#numTSLA").html(data.TSLA.gain);
        $("#proTSLA").html(data.TSLA.percentage);

        $("#numberAMZN").text(data.AMZN.number);
        $("#numAMZN").html(data.AMZN.gain);
        $("#proAMZN").html(data.AMZN.percentage);

        $("#numberMSFT").text(data.MSFT.number);
        $("#numMSFT").html(data.MSFT.gain);
        $("#proMSFT").html(data.MSFT.percentage);

        $("#numberBTC").text(data.BTC.number);
        $("#numBTC").html(data.BTC.gain);
        $("#proBTC").html(data.BTC.percentage);

        $("#numberXRP").text(data.XRP.number);
        $("#numXRP").html(data.XRP.gain);
        $("#proXRP").html(data.XRP.percentage);

        $("#numberHEIA").text(data.HEIA.number);
        $("#numHEIA").html(data.HEIA.gain);
        $("#proHEIA").html(data.HEIA.percentage);
    }

    refreshContent();
    setInterval(refreshContent, 2000);

    function updateStockColor(oldValue, newValue, element) {
        
        if (oldValue < newValue) {
          element.classList.remove("whiteTxt");
          element.classList.remove("redTxt");
          element.classList.add("greenTxt");
        } else if (oldValue > newValue) {
          element.classList.remove("whiteTxt"); 
          element.classList.remove("greenTxt");
          element.classList.add("redTxt");
        } else {
          element.classList.add("whiteTxt");
          element.classList.remove("redTxt");
          element.classList.remove("greenTxt");
        }
    }

</script>
<script src="main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

</html>